{{ if $.Site.Params.analytics }}
<script>
(function(){
    let retention=0;
    let data={visit:{
        referer: document.referrer        
    }};
    let options={
        method: 'post',
        headers: {
            'content-type':'application/json'
        }
    };
    let baseUrl={{- $.Site.Params.analytics -}};
    function postVisit(url,data,options){
        data.visit.retention=retention;
        retention+=10;
        options.body=JSON.stringify(data);

        fetch(url,options)
            .then(response=>response.json())
            .then(json=>{
                console.log(json);
                data.visit.id=json.id;
                options.method='put';
                url=baseUrl+"/"+json.id;
                setTimeout(postVisit,20000,url,data,options);
            }).catch(e=>console.log(e));
    }
    postVisit(baseUrl,data,options);
})();
</script>
{{ end }}